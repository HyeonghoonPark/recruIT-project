<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.recruit.mapper.ResumeMapper">

	<select id="read" resultType="com.recruit.domain.AdminResumeVO">
		select
		bno, userid, title, pname,
		email, birth
		from
		project.tbluser
		where id = #{id}
	</select>

	<update id="update">
		update project.tbluser set
		pw = #{pw}, pname =
		#{pname}, email = #{email}, birth = #{birth}
		where id = #{id}
	</update>

	<delete id="delete">
		delete from project.tbluser where id = #{id}
	</delete>

	<select id="listAll" resultType="com.recruit.domain.AdminResumeVO">
	<![CDATA[
	select
		bno, title
	from
		project.tblresume
	where
		userid = #{id}
	order by bno
	]]>
	</select>

	<insert id="createROne">
	  <![CDATA[
	  insert 
	  into project.tblresume (userid, title, coverletter, jobstateid, jobgroupid)
	  values("jin3", #{title}, #{coverletter}, #{jobstateid}, #{jobgroupid})
	  ]]>
	</insert> 
	
	<!-- 이력서 등록한 거 바로 확인 -->
	<select id="readRLastCreatedOne" resultType="java.lang.Integer">
  	select MAX(bno)
	from project.tblresume
	where userid = #{id}
	;
	</select>

		<!-- 이력서 확인 -->
		<select id="readROne" resultType="com.recruit.domain.ResumeVO">
    <![CDATA[
  select *
  from
  	project.tblresume
  where 
  	bno = #{bno}
      ]]>
		</select>

	<!-- 이력서 수정 -->
	<update id="updateROne">
	<!-- 안소연 -->
	<![CDATA[
	update project.tblresume 
	set title = #{title}, address = #{address}, postcode = #{postcode}, coverletter = #{coverletter}, jobstateid = 1, jobgroupid = 1, rgbid = 'Z', rgsid = 102, employstatusid = 1, salaryid = 1, img = #{img}
	where bno = #{bno}
    ]]>
	</update>

	<!-- 이력서 삭제 -->
	<delete id="deleteROne">
	delete
	from
	tblresume
	where bno = #{bno}
	</delete>

	<select id="selectRList" resultType="com.recruit.domain.ResumeVO">
 	<![CDATA[
	select *
	from 
	project.tblresume
	where userid = #{id}
  	]]>
	</select>

	<!-- 이력서 이미지 등록 -->
	<!--
	  update project.tblresume 
	 set img = #{img}
	 where bno = MAX(bno);
	 update tblresume R1
	 set img = #{img}
	 where bno = (select *
	 			FROM (SELECT Max(bno)
	 					from tblresume R2
	 					where userid = #{id}) R3); -->
	 					
	<update id="addRimgAttach">
  <![CDATA[
	
	update tblresume R1
	set img = #{img}
	where bno = (select *
				from (select Max(bno)
						from tblresume R2) R3);
  ]]>
	</update>




	<!-- Rmodify POST 일 경우 무조건 함께 가도록  -->
	<!-- 이력서 PTel 삭제 -->
	<delete id="deleteTOne">
	<![CDATA[
	delete from project.tbltel where telid= #{telid}
	]]>
	</delete>	
	
	<!-- 이력서 PTel 목록 삭제 -->
	<delete id="deleteTList">
	<![CDATA[
	delete from project.tbltel where rid= #{rid}
	]]>
	</delete>	
	
	<!-- 이력서 PTel 등록 -->
	<insert id="createTOne">
	<![CDATA[
	insert into project.tbltel(rid, teltitle, tel)
	values(#{rid}, #{teltitle}, #{tel})
	
	]]>
	</insert>
	
	
	
	
	<!-- 이력서 PTel 확인 -->
	<select id="selectPTelList" resultType="com.recruit.domain.PTelVO">
 	<![CDATA[
	select t.*
	from project.tbltel t
	where t.rid=#{bno}
  	]]>
	</select>
	
	
	<!-- 이력서 PTel 수정 -->
	<update id="updateTOne">
	<![CDATA[
	update project.tbltel
	set teltitle = #{teltitle}, tel = #{tel} 
	where rid = #{ptvoid}
	]]>
	<!-- front에서 name이 ptvoid인거 -->
	</update>
	
	

	
	
	
	
	
	
	<!-- 이력서 PWebsite 등록 -->
	<insert id="createPWebSite">
	<![CDATA[
	insert into project.tblwebsite(rid, webtitle, webadd)
	values(#{rid}, #{webtitle}, #{webadd})
	]]>
	</insert>
	
	<!-- 이력서 PWebsite 확인 -->
	<select id="selectPWebSiteList" resultType="com.recruit.domain.PWebSiteVO">
	<![CDATA[
	select*
    from project.tblwebsite
    where rid=#{bno};
	]]>
	</select>
	
	<!-- 이력서 PWebsite 수정 -->
	<update id="updatePWebSite">
	<![CDATA[
	update project.tblwebsite
	set webtitle = #{webtitle}, webadd = #{webadd} 
	where rid = #{rid}
	]]>
	</update>
	
	<!-- 이력서 PWebsite 삭제 -->
	<delete id="deletePWebSite">
	<![CDATA[
	delete from project.tblwebsite where rid= #{bno}
	]]>
	</delete>
	
	<!-- 이력서 PWebsiteList 삭제 -->
	<delete id="deleteWList">
	<![CDATA[
	delete from project.tblwebsite where rid= #{rid}
	]]>
	</delete>
	
	<!-- 이력서 REdu 등록 -->
	<insert id="createResumeEdu">
	<![CDATA[
	insert into project.tblResumeEdu(resumenum, schoolname, major, enterdate, gradudate, edustatus)
	values(#{resumenum}, #{schoolname}, #{major}, #{enterdate}, #{gradudate}, #{edustatus})
	]]>
	</insert>
	
	<!-- 이력서 REdu 확인 -->
	<select id="readResumeEdu" resultType="com.recruit.domain.ResumeEduVO">
	<![CDATA[
	select e.*, r.*
	from project.tblResumeEdu e, project.tblresume r
	where e.resumenum=r.bno
	]]>
	</select>
	
	<!-- 이력서 REdu 수정 -->
	<update id="updateResumeEdu">
	<![CDATA[
	update project.tblResumeEdu
	set schoolname = #{schoolname}, major = #{major}, enterdate = #{enterdate} , gradudate = #{gradudate} , edustatus = #{edustatus} 
	where resumenum = #{resumenum}
	]]>
	</update>
	
	<!-- 이력서 REdu 삭제 -->
	<delete id="deleteResumeEdu">
	<![CDATA[
	delete from project.tblResumeEdu where resumenum= #{bno}
	]]>
	</delete>
	
	<!-- 이력서 RCareer 등록 -->
	<insert id="createResumeCareer">
	<![CDATA[
	insert into project.tblResumeCareer(resumenum, cname, jobdescription, startjob, finishjob, salary)
	values(#{resumenum}, #{cname}, #{jobdescription}, #{startjob}, #{finishjob}, #{salary})
	]]>
	</insert>
	
	<!-- 이력서 RCareer 확인 -->
	<select id="readResumeCareer" resultType="com.recruit.domain.ResumeCareerVO">
	<![CDATA[
	select c.*, r.*
	from project.tblResumeCareer c, project.tblresume r
	where c.resumenum=r.bno
	]]>
	</select>
	
	<!-- 이력서 RCareer 수정 -->
	<update id="updateResumeCareer">
	<![CDATA[
	update project.tblResumeCareer
	set cname = #{cname}, jobdescription = #{jobdescription}, startjob = #{startjob} , finishjob = #{finishjob} , salary = #{salary} 
	where resumenum = #{resumenum}
	]]>
	</update>
	
	<!-- 이력서 RCareer 삭제 -->
	<delete id="deleteResumeCareer">
	<![CDATA[
	delete from project.tblResumeCareer where resumenum= #{bno}
	]]>
	</delete>
	
	<!-- 이력서 RLicense 등록 -->
	<insert id="createRLicense">
	<![CDATA[
	insert into project.tbllicense(rid, test, publeoffice, acquidate)
	values(#{rid}, #{test}, #{publeoffice}, #{acquidate})
	]]>
	</insert>
	
	<!-- 이력서 RLicense 확인 -->
	<select id="selectRLicenseList" resultType="com.recruit.domain.RLicenseVO">
	<![CDATA[
	select *
	from project.tbllicense
	where rid=#{bno};
	]]>
	</select>
	
	
	<!-- 이력서 RLicense 수정 -->
	<update id="updateRLicense">
	<![CDATA[
	update project.tbllicense
	set test = #{test}, publeoffice = #{publeoffice}, acquidate = #{acquidate}
	where rid = #{rid}
	]]>
	</update>
	
	<!-- 이력서 RLicense 삭제 -->
	<delete id="deleteRLicense">
	<![CDATA[
	delete from project.tbllicense where rid= #{bno}
	]]>
	</delete>
	
	<!-- 이력서 RLang 등록 -->
	<insert id="createResumeLanguage">
	<![CDATA[
	insert into project.tblResumeLanguage(rid, lid, test, score, publeoffice, acquidate)
	values(#{rid}, #{lid}, #{test}, #{score}, #{publeoffice}, #{acquidate})
	]]>
	</insert>
	
	<!-- 이력서 RLang 확인 -->
	<select id="selectResumeLanguageList" resultType="com.recruit.domain.ResumeLanguageVO">
	<![CDATA[
	 select*
    from project.tblresumeLanguage
    where rid=#{bno};
	]]>
	</select>
	
	<!-- 이력서 RLang 수정 -->
	<update id="updateResumeLanguage">
	<![CDATA[
	update project.tblResumeLanguage
	set test = #{test}, score = #{score}, publeoffice = #{publeoffice}, acquidate = #{acquidate}
	where rid = #{rid}
	]]>
	</update>
	
	<!-- 이력서 RLang 삭제 -->
	<delete id="deleteResumeLanguage">
	<![CDATA[
	delete from project.tblResumeLanguage where rid= #{bno}
	]]>
	</delete>
</mapper>